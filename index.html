<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset=UTF-8>
        <title>Pac Kart</title>
    </head>
    <body>
        <script>
//header
document.body.innerHTML = `
<style>

.save_button:hover{
    color:white;
    cursor:pointer;
    background:#bbb7ce;}

.save_button{
        align-items: inherit;
        text-align: center;
        line-height: 75px;
        background: #79797979;
        font-size:xx-large;
}

[data-sound_row_select="true"]{
        background:#cce1f5;
}

.sound_row_select{
    cursor:pointer;
}
.sound_row_select:hover{
    background:#cce1f5;
}

.data_bar_options{
    width:20px;
    font-size:larger;
    padding:7px;
    line-height:35px;
    cursor:pointer;
    text-align:center;
    vertical-align:center;
}
.data_bar_options:hover{
    color:white;
    background:#787878;
}

[data-select="true"] {
background:#646464;
}

[data-is_active='true']{
    background:#787878;
}

[data-file_select="true"] {
background:#cacaca;
}

.data_types_bar{
    width:100%;
    height:35px;
    background:#cacaca;
}

.noselect {
  -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
}

.bar{    width: 100%;
    height: 15px;
    background: #9a9a9a;
}

.folder{
        padding: 10px;
}

.file{
    padding: 10px;
    padding-left: 25px;
    cursor:pointer;
}
.file:hover{
    background:#cacaca;
}

.file:active{
    color:azure;
}


.header{
    line-height: 64px;
    font-size: xx-large;
    color: #d9d9d9;
    text-align: center;
    background-color: #ada1a1;
    height: 64px;
}

.header_button{
    padding: 16px;
    color: #d9d9d9;
    text-decoration: none;
    cursor: pointer;
}

.header_button:hover{
    color:white;
    background-color:#646464;
}
.header_line_bottom{background-color:#646464;
    height: 3px;
}

td,th,binary_table,tr{
    border: 1px #aaa solid;
}

td,th{
        padding: 2px;
}

th{
        background-color: #f2f2f2;

}

.binary_table{
    margin: 1em 0;
    background-color: #f9f9f9;
    border-collapse: collapse;
    color: black;
}


.unknown_value{
    color: #000000;
    background-color: #d0d0d0
}


</style>

<div class='header'>
    <nav class='noselect'>
        <a id='main_button' class='header_button' data-select='false'>main</a>
        <a id='x_button_documentation' class='header_button' data-select='false'>.x* file documentation</a>
    </nav>
</div>

<div class='header_line_bottom'></div>
<div id='main_page'>
</di>


`

function load_main_page() {
    if (document.getElementById("main_button").dataset.select == "true") {
        document.getElementById("main_button").addEventListener("click", load_main_page);
        document.getElementById("x_button_documentation").addEventListener("click", load_x_documentation);

        return
    } else {
        document.getElementById("main_button").dataset.select = "true"
        document.getElementById("x_button_documentation").dataset.select = "false"
        document.getElementById("main_button").addEventListener("click", load_main_page);
        document.getElementById("x_button_documentation").addEventListener("click", load_x_documentation);

        document.getElementById("main_page").innerHTML = `
<section id="main" style="
    margin: 2%;
">
    <input id="file_input" type="file">
    
    <div id="radio">
        <input type="radio" id="rally" name="a" checked>
        <label for="a">Rally</label>
    
        <input name="a" type="radio" id="baron">
        <label for="baron">baron</label>
    
        <input id="hot" name="a" type="radio">
        <label for="hot">hot</label>

    </div>

    <div class="bar">
    </div>
    
    <div style="
    display: flex;
    height: 750px;
">

<div id='left_bar' style="
    flex: 0 0 10%;">

    <div id="file_view" style="
        background: #e6e6e6;
        overflow-y: auto;
        height:90%;">
    </div>
    <div class='save_button noselect' id="save_button"> save
        </div>    
</div>
    <div id='main_program' style="flex: 1;">
    </div>
</div>
<div class="bar">

<br>
<br>check:ps2/psp :.vag
.mod
.it
.mid
.dis
<br>texture formats (pc rgba8888 ?)
<br>world options editor
<br> update sound in sound table
    
    
    </section>`
        document.getElementById("file_input").addEventListener("change", input_file);
        return
    }
}

function load_x_documentation() {
    if (document.getElementById("x_button_documentation").dataset.select == "true") {
        document.getElementById("main_button").addEventListener("click", load_main_page);
        document.getElementById("x_button_documentation").addEventListener("click", load_x_documentation);

        return
    } else {
        document.getElementById("x_button_documentation").dataset.select = "true"
        document.getElementById("main_button").dataset.select = "false"
        document.getElementById("main_button").addEventListener("click", load_main_page);
        document.getElementById("x_button_documentation").addEventListener("click", load_x_documentation);

        document.getElementById("main_page").innerHTML = `<main style="
    margin: 176px;
    border: ridge;
    padding: 10px;">
    <section id="main">
        <h1>wip</h1>
    </section>

    <section id="file">
        <h1>.x* introduction</h1>
        <p>this type of file is used in 3 known games:
        <br>Hot Wheels Velocity X
        <br>Snoopy vs. the Red Baron
        <br>Pac Man World Rally      
        </p> 

        <p>the file extension changes based on console
        <br>pc: .xpc
        <br>gamecube: .xgc 
        <br>xbox: .xdx
        <br>psp .xpp
        <br>ps2 .XPS
        </p>

        <p>the file can contain a wide veraity of data
        <br>sounds/music
        <br>geometry
        <br>textures
        <br>animations
        <br>ect
        </p>

        <p>there are a number of differences between each game, console and file type
        <br>currently focusing on the gamecube version of pac man world rally,
        <br>
        </p>

        <p>Gamecube uses big endian</p>

            <hr>
            
            <h2> Section 1: </h2>
            <h3> File Header </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> <a href="https://en.wikipedia.org/wiki/Magic_number_(programming)#In_files">magic </a> <br> value always 33620128 or 02 01 00 A0 </td>
                    </tr>
                    <tr>
                        <td> 04 </td>
                        <td> u32 </td>
                        <td> magic <br> value always 67174575 or 04 01 00 AF </td>
                    </tr>
                    <tr>
                        <td> 08 </td>
                        <td> u32 </td>
                        <td> section 2: file directory magic <br> value different depending on region / game </td>
                    </tr>
                    <tr>
                        <td> 12 </td>
                        <td> u32 </td>
                        <td> number of files </td>
                    </tr>
                </tbody>
            </table>
            <p>pac:
            <br>gc / ntsc: 267
            <br>ps2: pal : 274
            <br>ps2: ntsc: 267
            <br>ps2: demo: 249
            <br>psp: pal :274
            <br>xbox:demo: 243
            <br>pc:??? 267
            <br><br>snoopy vs the red barron:
            <br>pc: ???: 274
            <br><br>hot wheels x
            <br>pc: ntsc: 183
            </p>

            <hr>


            <h2> Section 2: </h2>
            <h3> file directory </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> magic </td>
                    </tr>
                    <tr>
                        <td> 04 </td>
                        <td> u32 </td>
                        <td> type of file:
                        <br> * 0 = car
                        <br> * 1 = interface
                        <br> * 2 = item
                        <br> * 3 = ???
                        <br> * 4 = world
                        <br> * 5 = colliders
                        <br> * 6 = world texture
                        <br> * 7 = geometry
                        <br> * 8 = share
                        <br> * 10 = music
                        <br><small>credit to ??? on dicord</small>
                    </td>
                    </tr>
                    <tr>
                        <td> 08 </td>
                        <td> u32 </td>
                        <td> file type index
                        <br> files with different types can have the same index </td>
                    </tr>
                    <tr>
                        <td> 12 </td>
                        <td> u32 </td>
                        <td> always 0 </td>
                    </tr>
                    <tr>
                        <td> 16 </td>
                        <td> u32 </td>
                        <td> amount bytes </td>
                    </tr>
                    <tr>
                        <td> 20 </td>
                        <td> u32 </td>
                        <td> offset </td>
                    </tr>                    
                </tbody>
            </table>
            
            <p>foucusing on world type</p>

            <hr>

            <h2> Section 3: </h2>
            <h3> File header </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> offset to 2nd offset list </td>
                    </tr>
                    <tr>
                        <td> 04 </td>
                        <td> u32 </td>
                        <td> offset to 1st offset list </td>
                    </tr>
                    <tr>
                        <td> 08 </td>
                        <td> u32 </td>
                        <td> amount of sounds </td>
                    </tr>
                    <tr>
                        <td> 12 </td>
                        <td> u32 </td>
                        <td> amount 2nd part of 2nd offset list </td>
                    </tr>
                    <tr>
                        <td> 16 </td>
                        <td> u32 </td>
                        <td> amount ??? part of 1st offset list </td>
                    </tr>
                    <tr>
                        <td> 20 </td>
                        <td> u32 </td>
                        <td> amount of textures </td>
                    </tr>
                    <tr>
                        <td> 24 </td>
                        <td> u32 </td>
                        <td> offset to textures </td>
                    </tr>
                    <tr>
                        <td> 28 </td>
                        <td> u32 </td>
                        <td> amount ??? part of 1st offset list </td>
                    </tr>
                    <tr>
                        <td> 32 </td>
                        <td> u32 </td>
                        <td> amount of offsets in sound offset list  </td>
                    </tr>
                    <tr>
                        <td> 36 </td>
                        <td> u32 </td>
                        <td> always 0 </td>
                    </tr>
                    <tr>
                        <td> 40 </td>
                        <td> u32 </td>
                        <td> always 0 </td>
                    </tr>
                    <tr>
                        <td> 44 </td>
                        <td> u32 </td>
                        <td> always 0 </td>
                    </tr class='unknown_value'>
                    <tr class='unknown_value'>
                        <td> 48 </td>
                        <td> u32 </td>
                        <td> unknown, low number </td>
                    </tr>
                    <tr>
                        <td> 52 </td>
                        <td> u32 </td>
                        <td> amount ??? part of 1st offset list </td>
                    </tr>
                    <tr>
                        <td> 56 </td>
                        <td> u32 </td>
                        <td> amount 1st part of 2nd offset list </td>
                    </tr>
                    <tr>
                        <td> 60 </td>
                        <td> u32 </td>
                        <td> offset to animations </td>
                    </tr>
                </tbody>
            </table>

            <p>extended file header</p>
            <p>values depend on file type, always 0 for world type</p>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                     <tr>
                        <td> 64 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 68 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 72 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 76 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 80 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 84 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 88 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 92 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 96 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 100 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 104 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 108 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 112 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                     <tr>
                        <td> 116 </td>
                        <td> u32 </td>
                        <td> 0 </td>
                    </tr>
                </tbody>
            </table>

            <hr>

            <h2> Section 4: </h2>
            <h3> sound offset list </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 0 </td>
                        <td> u32 </td>
                        <td> offset to sound list </td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="3"> divisible by 32 </th>
                    </tr>
                </tfoot>


            </table>
            <p> each offset always +32
            <br> </p>

            <hr>

                  <h2> Section 5: </h2>
            <h3> sound list </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 0 </td>
                        <td> u32 </td>
                        <td> offset to sound data / offset + start of sound list </td>
                    </tr>
                    <tr>
                        <td> 4 </td>
                        <td> u32 </td>
                        <td> length of sound </td>
                    </tr>
                    <tr class='unknown_value'>
                        <td> 8 </td>
                        <td> u32 </td>
                        <td> 0 or FF FF FF FF </td>
                    </tr>
                    <tr>
                        <td> 12 </td>
                        <td> u32 </td>
                        <td> sound sample rate </td>
                    </tr>
                    <tr>
                        <td> 16 </td>
                        <td> u32 </td>
                        <td> always 0? </td>
                    </tr>
                    <tr class="unknown_value">
                        <td> 20 </td>
                        <td> u16 </td>
                        <td> ? volume ?  </td>
                    </tr>
                    <tr class="unknown_value">
                        <td> 22 </td>
                        <td> u16 </td>
                        <td> ??? 16 bits per sample maybe ???  </td>
                    </tr>
                    <tr>
                        <td> 24 </td>
                        <td> u32 </td>
                        <td> padding? always 0 </td>
                    </tr>
                    <tr>
                        <td> 28 </td>
                        <td> u32 </td>
                        <td> padding? always 0 </td>
                    </tr>
                  </tbody>
            </table>

            <hr>

            <h2> Section 6: </h2>
            <h3> sound data </h3>
            
            <p> pcm format<br>
            1 channels<br>
            16 bit </p>

            <hr>

            
            <h2> Section 7: </h2>
            <h3> 1st offset list </h3>
            
            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 0 </td>
                        <td> u32 </td>
                        <td> offset </td>
                    </tr>
                    <tr>
                        <td> 4 </td>
                        <td> u32 </td>
                        <td> index? </td>
                    </tr>
            </tbody>
        </table>

<hr>

            <h2> Section 8: </h2>
            <h3> more offsets: </h3>
            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> ?offset, end texture, start variables ? </td>
                    </tr>
                    <tr class='unknown_value'>
                        <td> 04 </td>
                        <td> u32 </td>
                        <td> 16 , 32 or 160 ? </td>
                    </tr>
                    <tr>
                        <td> 08 </td>
                        <td> u32 </td>
                        <td> offset start unknown section 98432 Float? </td>
                    </tr>
                    <tr>
                        <td> 12 </td>
                        <td> u32 </td>
                        <td> offset start cpu / item / checkpoint header </td>
                    </tr>
                    <tr class='unknown_value'>
                        <td> 16 </td>
                        <td> u32 </td>
                        <td> small value </td>
                    </tr>
                    <tr>
                        <td> 20 </td>
                        <td> u32 </td>
                        <td> offset start optional sections header</td>
                    </tr>
                    <tr>
                        <td> 24 </td>
                        <td> u32 </td>
                        <td> offset start unknown section end cpu list </td>
                    </tr>
                    <tr class='unknown_value'>
                        <td> 28 </td>
                        <td> u32 </td>
                        <td> small value </td>
                    </tr>
                    <tr>
                        <td> 32 </td>
                        <td> u32 </td>
                        <td> offset start unknown section / offset to offset fruit gate? </td>
                    </tr>
                </tbody>
            </table>

            <hr>

                        <h2> Section 9: </h2>
            <h3> collision header?: </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 36 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 40 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 44 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 48 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 52 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 56 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 60 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 64 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 68 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 72 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 76 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 80 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 84 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 88 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 92 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 96 </td>
                        <td> u32 </td>
                        <td> start strange values </td>
                    </tr>
                    <tr>
                        <td> 100 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 104 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 108 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 112 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 116 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 120 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 124 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 128 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 132 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 136 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 140 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 144 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 148 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 152 </td>
                        <td> u32 </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 156 </td>
                        <td> u32 </td>
                        <td> end strange values </td>
                    </tr>
                    <tr>
                        <td> 160 </td>
                        <td> float </td>
                        <td> related to colision </td>
                    </tr>
                    <tr>
                        <td> 164 </td>
                        <td> float </td>
                        <td> related to colision </td>
                    </tr>
                    <tr>
                        <td> 168 </td>
                        <td> float </td>
                        <td> related to colision </td>
                    </tr>
                    <tr>
                        <td> 172 </td>
                        <td> float </td>
                        <td> 1 </td>
                    </tr>
                    <tr>
                        <td> 176 </td>
                        <td> float </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 180 </td>
                        <td> float </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 184 </td>
                        <td> float </td>
                        <td> ? </td>
                    </tr>
                    <tr>
                        <td> 188 </td>
                        <td> float </td>
                        <td> unknown 1 </td>
                    </tr>
                    <tr>
                        <td> 192 </td>
                        <td> u32 </td>
                        <td> offset start colision table 2 -48 </td>
                    </tr>
                    <tr>
                        <td> 196 </td>
                        <td> u32 </td>
                        <td> unknown 19 change value = inf loading </td>
                    </tr>
                    <tr>
                        <td> 200 </td>
                        <td> float </td>
                        <td> unknown related to collision </td>
                    </tr>
                    <tr>
                        <td> 204 </td>
                        <td> float </td>
                        <td> unknown related to collision </td>
                    </tr>
                    <tr>
                        <td> 208 </td>
                        <td> float </td>
                        <td> unknown related to collision </td>
                    </tr>
                    <tr>
                        <td> 212 </td>
                        <td> u32 </td>
                        <td> unknown low value </td>
                    </tr>
                    <tr>
                        <td> 216 </td>
                        <td> u32 </td>
                        <td> unknown low value </td>
                    </tr>
                    <tr>
                        <td> 220 </td>
                        <td> u32 </td>
                        <td> unknown low value </td>
                    </tr>
                    <tr>
                        <td> 224 </td>
                        <td> u32 </td>
                        <td> offset, end colision table 1, start collision faces? </td>
                    </tr>
                    <tr>
                        <td> 228 </td>
                        <td> u32 </td>
                        <td> largest amount in collision faces? -1 </td>
                    </tr>
                    <tr>
                        <td> 232 </td>
                        <td> u32 </td>
                        <td> unknown always 00  </td>
                    </tr>
                    <tr>
                        <td> 236 </td>
                        <td> u32 </td>
                        <td> unknown always 00  </td>
                    </tr>
                    <tr>
                        <td> 240 </td>
                        <td> u32 </td>
                        <td> amount of sections in colision table 1 </td>
                    </tr>
                    <tr>
                        <td> 244 </td>
                        <td> u32 </td>
                        <td> unknown always 256 </td>
                    </tr>
                    <tr>
                        <td> 248 </td>
                        <td> u32 </td>
                        <td> unknown always 1 </td>
                    </tr>
                    <tr>
                        <td> 252 </td>
                        <td> u32 </td>
                        <td> unknown always 00  </td>
                    </tr>
                </tbody>
            </table>

            <h2> Section 3: </h2>
            <h3> collision table 1 </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> vertex sphere ? x </td>
                    </tr>
                    <tr>
                        <td> 04 </td>
                        <td> u32 </td>
                        <td> vertex sphere ? y </td>
                    </tr>
                    <tr>
                        <td> 08 </td>
                        <td> u32 </td>
                        <td> vertex sphere ? z </td>
                    </tr>
                    <tr>
                        <td> 12 </td>
                        <td> u32 </td>
                        <td> always -431602080 or CD CD CD CD </td>
                    </tr>
                    <tr>
                        <td> 16 </td>
                        <td> u32 </td>
                        <td> vertex x  </td>
                    </tr>
                    <tr>
                        <td> 20 </td>
                        <td> u32 </td>
                        <td> vertex y  </td>
                    </tr>
                    <tr>
                        <td> 24 </td>
                        <td> u32 </td>
                        <td> vertex z </td>
                    </tr>
                    <tr>
                        <td> 28 </td>
                        <td> u32 </td>
                        <td> unknown usually 1 </td>
                    </tr>
                    <tr>
                        <td> 32 </td>
                        <td> u32 </td>
                        <td> vertex x  </td>
                    </tr>
                    <tr>
                        <td> 36 </td>
                        <td> u32 </td>
                        <td> vertex y </td>
                    </tr>
                    <tr>
                        <td> 40 </td>
                        <td> u32 </td>
                        <td> vertex z </td>
                    </tr>
                    <tr>
                        <td> 44 </td>
                        <td> u32 </td>
                        <td> unknown usually 1 </td>
                    </tr class='unknown_value'>
                    <tr class='unknown_value'>
                        <td> 48 </td>
                        <td> u32 </td>
                        <td> unknown usually 0  </td>
                    </tr>
                    <tr>
                        <td> 52 </td>
                        <td> u32 </td>
                        <td> always CD CD CD CD </td>
                    </tr>
                    <tr>
                        <td> 56 </td>
                        <td> u32 </td>
                        <td> always CD CD CD CD </td>
                    </tr>
                    <tr>
                        <td> 60 </td>
                        <td> u32 </td>
                        <td> always CD CD CD CD </td>
                    </tr>
                </tbody>
            </table>

                        <hr>


                        <h2> Section 7: </h2>
            <h3> collision faces? </h3>
            
probably related to connecting the vertices from collision table 1 into faces
values are always u32
values increment
u32 0 values split collision types ?

            <hr>


            <h2> Section 3: </h2>
            <h3> collision table 2 </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> vertex ? x </td>
                    </tr>
                    <tr>
                        <td> 04 </td>
                        <td> u32 </td>
                        <td> vertex ? y </td>
                    </tr>
                    <tr>
                        <td> 08 </td>
                        <td> u32 </td>
                        <td> vertex ? z </td>
                    </tr>
                    <tr>
                        <td> 12 </td>
                        <td> u32 </td>
                        <td> always -107374176 or CC CC CC CC </td>
                    </tr>
                    <tr>
                        <td> 16 </td>
                        <td> u32 </td>
                        <td> vertex ? x </td>
                    </tr>
                    <tr>
                        <td> 20 </td>
                        <td> u32 </td>
                        <td> vertex ? y  </td>
                    </tr>
                    <tr>
                        <td> 24 </td>
                        <td> u32 </td>
                        <td> vertex ? z </td>
                    </tr>
                    <tr>
                        <td> 28 </td>
                        <td> u32 </td>
                        <td> always -107374176 or CC CC CC CC </td>
                    </tr>
                    <tr>
                        <td> 32 </td>
                        <td> u32 </td>
                        <td> amount of values in end colision table 3  </td>
                    </tr>
                    <tr>
                        <td> 36 </td>
                        <td> u32 </td>
                        <td> offset end collision table 3 </td>
                    </tr>
                    <tr>
                        <td> 40 </td>
                        <td> u32 </td>
                        <td> offset header colision table 3 </td>
                    </tr>
                    <tr>
                        <td> 44 </td>
                        <td> u32 </td>
                        <td> amount of sections in colision table 3 header </td>
                    </tr class='unknown_value'>
                </tbody>
            </table>

            <hr>

            <h2> Section 3: </h2>
            <h3> collision table 3 head </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> offset start data </td>
                    </tr>
                    <tr>
                        <td> 04 </td>
                        <td> u32 </td>
                        <td> amount of data sections </td>
                    </tr>
                    <tr>
                        <td> 08 </td>
                        <td> u32 </td>
                        <td> ? large number, most values are the same </td>
                    </tr>
                    <tr>
                        <td> 12 </td>
                        <td> u32 </td>
                        <td> ... repeat depending on colision table 2 [44] </td>
                    </tr>
                    <tr>
                        <td> 16 </td>
                        <td> u32 </td>
                        <td> ...after append CD CD CD CD until index divisible by 16 </td>
                    </tr>
                </tbody>
            </table>

            <h3> collision table data </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> vertex ?x sphere </td>
                    </tr>
                    <tr>
                        <td> 04 </td>
                        <td> u32 </td>
                        <td> vertex ?y sphere </td>
                    </tr>
                    <tr>
                        <td> 08 </td>
                        <td> u32 </td>
                        <td> vertex ?z sphere </td>
                    </tr>
                    <tr>
                        <td> 12 </td>
                        <td> u32 </td>
                        <td> vertex ?w sphere </td>
                    </tr>
                    <tr>
                        <td> 16 </td>
                        <td> u32 </td>
                        <td> always 0 </td>
                    </tr>
                    <tr>
                        <td> 20 </td>
                        <td> u16 </td>
                        <td> ? usually increments / FF </td>
                    </tr>
                    <tr>
                        <td> 22 </td>
                        <td> u16 </td>
                        <td> ? usually increments / FF </td>
                    </tr>
                    <tr>
                        <td> 24 </td>
                        <td> b8 </td>
                        <td> append 8 CD </td>
                    </tr>
                </tbody>
            </table>

            <h3> end </h3>

            <table class='binary_table'>
                <tbody>
                    <tr>
                        <th> Offset </th>
                        <th> Type </th>
                        <th> Description </th>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> ? usually increments </td>
                    </tr>
                    <tr>
                        <td> 00 </td>
                        <td> u32 </td>
                        <td> append CD until index divisible by 16 </td>
                    </tr>
                </tbody>
            </table>


----------------------------------------
||||    optional sections header    ||||
----------------------------------------

00 | u32 | type of section
04 | u32 | number of bytes per entery
08 | u32 | amount of enteries
12 | u32 | offset to first entry

section always 256 bytes

------------------------------------
||||    type 0 section entry    ||||
------------------------------------

Starting Points

000 | u32 | index
004 | u16 | 0
006 | u16 | 0 or 1 other values no change
008 | u32 | 0 other values crash
012 | u16 | 1 other values no change
014 | u16 | 8 other values no change
016 | u16 | 1
018 | u16 | 8
020 | u32 | 0
024 | u32 | 0
028 | u32 | 0
032 |Float| position
036 |Float| position
040 |Float| position
044 |Float| 1
048 |Float| rotation
052 |Float| rotation
056 |Float| rotation
060 |Float| 1
064 | u32 | 0
068 | u32 | 8
072 | u16 | 0
074 | u8  | 1
075 | u8  | 1
076 |Float| 500
080 |Float| 1000
084 | u32 | 0
088 | u32 | 0
092 | u32 | 0
096 | u32 | 0
100 | u32 | 0
104 | u32 | 0
108 | u32 | 0
112 | u8  | unknown
113 | u16 | ffff unknown other values no change 
115 | u8  | 0
116 | u32 | 0
120 | u8  | 1
121 | u8  | 1 if other number, index is moved last
122 | u16 | 0
124 | u32 | 0

-------------------------------------
||||    type 1 section entry    |||| 
-------------------------------------

start / end camera ?
-------------------------------------
||||    type 4 section entry    |||| 
-------------------------------------

respawn ?

-------------------------------------
||||    type 5 section entry    |||| 
-------------------------------------

model position?

000 | u32 | index
004 | u16 | 05
006 | u16 | 0
008 | u32 | 0
012 | u16 | 1
014 | u32 | 8
016 | u32 | 1
018 | u32 | 8
020 | u32 | 0
024 | u32 | 0
028 | u32 | 0
032 |Float| always 1 position x
036 | u32 | 0
040 | u32 | 0
044 | u32 | 0
048 | u32 | 0
052 |Float| always 1 position y
056 | u32 | 0
060 | u32 | 0
064 | u32 | 0
068 | u32 | 0
072 |Float| always 1 position z
076 | u32 | 0
080 | u32 | 0
084 | u32 | 0
088 | u32 | 0
092 |Float| always 1 position w
096 | u32 | 0
100 | u32 | offset
104 | u32 | 0
108 | u32 | 0

------------------------------------
||||    type 8 section entry    ||||
------------------------------------

000 | u32 | index
004 | u16 | 8
006 | u16 | 0
008 | u32 | 0
012 | u16 | 1
014 | u16 | 8
016 | u16 | 1
018 | u16 | 8
020 | u32 | 0
024 | u32 | 0
028 | u32 | 0
032 | u32 | 0
036 | u32 | 8
040 | u32 | 0
044 | u32 | 0
048 | u32 | 0
052 | u32 | 0
056 | u32 | 0
060 | u32 | 0
064 | u32 | 0
068 | u32 | 0
072 | u32 | offset top of the collision section
076 | u32 | offset bottom of the section ? last 16 bytes

----------------------------------
||||    type 8 section ???    ||||
----------------------------------

000 | u32 | 0
004 | u32 | 0
008 |float| 3F 80 00 00 
012 |float| 43 B9 15 FD

016 | u32 | 02 03 00 01
020 | u32 | 2C 03 00 00
024 | u32 | 2D 03 00 00
028 | u32 | 93 03 00 00

032 |float|80 00 00 00
036 |float| 3F 80 00 00
040 | u32 | 00 00 00 00
044 |float| 42 9A 5B 3E

048 | u32 | 02 03 00 01
052 | u32 | 92 03 00 00
056 | u32 | 35 03 00 00
060 | u32 | 36 03 00 00


064 | u32 | 00 00 00 00
068 | u32 | 00 00 00 00
072 |float| BF 80 00 00
076 |float| C3 8F B6 6C

080 | u32 | 02 03 00 01
084 | u32 | 3C 03 00 00
088 | u32 | 3D 03 00 00
092 | u32 | 3E 03 00 00

096 | u32 | 00 00 00 00
100 |float| BF 80 00 00
104 | u32 | 00 00 00 00
108 |float| C2 D3 97 1D

112 | u32 | 02 03 00 01
116 |float| 44 03 00 00
120 |float| 45 03 00 00
124 |float| 46 03 00 00

128 |float| 3F 80 00 00
132 |float| 80 00 00 00 
136 | u32 | 00 00 00 00 
140 |float| C1 19 EC 40 

144 | u32 | 02 03 00 01 
148 |float| 4C 03 00 00 no change
152 |float| 4D 03 00 00 no change
156 |float| 4E 03 00 00 no change

160 |float| BF 80 00 00 if edited boost extends ?
164 | u32 | 00 00 00 00 no change
168 | u32 | 00 00 00 00 no change
172 |float| C4 B9 6B FC no change

176 | u32 | 00 03 00 00 0 no change
180 |float| 54 03 00 00 1  no change
184 |float| 55 03 00 00 1 no change
188 |float| 56 03 00 00  1 no change

192 | u32 | 00 00 00 00
196 | u32 | 00 2D 72 40 offset
200 | u32 | 00 00 00 00
204 | u32 | 00 00 00 00

-------------------------------------
||||    type 10 section entry    |||| 
-------------------------------------

pac pellet / fruit activators

-------------------------------------
||||    type 11 section entry    ||||
-------------------------------------

respawn from player?

-------------------------------------
||||    type 13 section entry    |||| 
-------------------------------------

custom stage object ?


-------------------------------------
||||    type 14 section entry    |||| 
-------------------------------------

animation?


-------------------------------------
||||    type 15 section entry    ||||
-------------------------------------

objects

00 | u32 | unknown
04 | u16 | 0f
06 | u16 | 0B
08 | u32 | 0
12 | u32 | 8
16 | u32 | 8
20 | u32 | 0
24 | u32 | 0
28 | u32 | 0
32 |Float| position
36 |Float| position
40 |Float| position
44 |Float| 1
48 | u32 | ?
52 | u32 | ?
56 | u32 | offset
60 | u32 | render distance
64 | u32 | 0
68 | u32 | ffff0000
72 | u32 | 01010101
76 | u32 | 0

---------------------------------------
||||    special collision header    |||| 
---------------------------------------

00 |Float| ?
04 |Float| ?
08 |Float| ?
12 |Float| 0
16 | u32 | offset special collision list 2 -96
20 | u32 | offset special collision list 1
24 | u32 | low number
28 | u32 | amount of numbers in next list
32 |Float| 500
36 |Float| ?
40 |Float| 500
44 | u32 | low number
48 | u32 | 1
52 | u32 | low number
56 | u32 | 0
60 | u32 | 0

----------------------------------------------
||||    special collision list 1    ||||
----------------------------------------------

0 | u32 | low number, start at 1, increment by 1 usually

----------------------------------------------
||||    special collision list 2    ||||
----------------------------------------------

00 | u32 | 0
04 | u32 | 0
08 | u32 | 0
12 | u32 | 0
16 | u32 | 0
20 | u32 | 0
24 | u32 | 0
28 | u32 | 0
32 | u32 | 0
36 | u32 | 0
40 | u32 | 0 sometimes a number of entries in offset
44 | u32 | 0 sometimes offset
48 | u32 | number of entries in offset
52 | u32 | offset
56 | u32 | 0
60 | u32 | 0
64 | u32 | 0
68 | u32 | 0
72 | u32 | 0
76 | u32 | 0

---------------------------------------
||||    special collision list 3    ||||
---------------------------------------

00 | u32 | offset
04 | u32 | offset
08 | u32 | offset
12 | u32 | offset
16 | u32 | offset
20 | u32 | offset
24 | u32 | offset
28 | u32 | offset

-------------------------------------
||||   item / CPU Routes header  ||||
-------------------------------------

00 | u32 | offset start cpu route entries
04 | u32 | amount of entries
08 | u32 | FF FF FF FF
12 | u32 | 00 00 00 00
16 | u32 | 00 00 00 00
20 | u32 | 00 00 00 00
24 | u32 | 00 00 00 00
28 | u32 | 00 00 00 00

--------------------------------------
||||   item / CPU Routes entries  ||||
--------------------------------------

like the optional sections above but not linked directly by it

000 | u32 | index
004 | u16 | 10
006 | u16 | 0
008 | u32 | 0
012 | u16 | 1
014 | u16 | 0
016 | u16 | 1
018 | u16 | 0
020 | u32 | 0
024 | u32 | 0
028 | u32 | 0
032 |Float| position
036 |Float| position
040 |Float| position
044 |Float| 1
048 | u32 | amount of floats in list ?
052 | u32 | offset to link list 2 , 1
056 | u32 | offset to link list 2 , 2
060 | u32 | amount of entries in 1st link list?
064 | u32 | offset to link list 1
068 |Float| cpu / item deviation, low values break blue bombers ?
072 | u16 | 08 ? 04 00 = inf woo  always last place | 08 = random lap counts / random place
074 | u16 | 0
076 | u32 | 64 0 0 0
080 | u32 | 0
084 | u32 | 0
088 | u32 | 0
092 | u32 | 0
096 | u32 | 0
100 | u32 | 0
104 | u32 | 0
108 | u32 | 0
112 | u32 | 0
116 | u32 | 0 based index
120 | u32 | 0
124 | u32 | 0
                                                    4703872
------------------------------------------
||||   item / CPU Routes link list 1  |||| 
------------------------------------------

00 | u32 | related to cpu / checkpoints
04 | u32 | related to cpu / checkpoints
08 | u32 | related to cpu / checkpoints
12 | u32 | related to cpu / checkpoints
16 | u32 | related to cpu / checkpoints
20 | u32 | related to cpu / checkpoints
24 | u32 | related to cpu / checkpoints
28 | u32 | related to cpu / checkpoints

----------------------------------------------
||||   item / CPU Routes link list 2 , 1  |||| 
----------------------------------------------

00 |Float| distance between current and previous point
04 |Float| distance between current and previous point
08 |Float| distance between current and previous point
12 |Float| distance between current and previous point
16 |Float| distance between current and previous point
20 |Float| distance between current and previous point
24 |Float| distance between current and previous point
28 |Float| distance between current and previous point

changing values does not seem to do anything

----------------------------------------------
||||   item / CPU Routes link list 2 , 2  ||||  
----------------------------------------------

00 | u32 | related to cpu / checkpoints
04 | u32 | related to cpu / checkpoints
08 | u32 | related to cpu / checkpoints
12 | u32 | related to cpu / checkpoints
16 | u32 | related to cpu / checkpoints
20 | u32 | related to cpu / checkpoints
24 | u32 | related to cpu / checkpoints
28 | u32 | related to cpu / checkpoints

----------------------------------------------
||||   offsets ?course obstacles / gates  ||||
----------------------------------------------

00 | u32 | offset
04 | u32 | offset / 0
08 | u32 | offset / 0
12 | u32 | offset / 0
16 | u32 | offset / 0
20 | u32 | offset / 0
24 | u32 | offset / 0
28 | u32 | offset / 0

----------------------------------------------
||||   unknown  ||||
----------------------------------------------

00 | u32 | offset 43
04 | u32 | offset 111232 next list?
08 | u32 | offset 15
12 | u32 | offset 111424 next list? 2

----------------------------------------------
||||   unknown  list ||||
----------------------------------------------

00 | u32 | offset

-----------------
||||   model ||||
-----------------

000 | u16 | always 06 01
002 | u16 | type of model?
004 | u32 | offset sections
008 | u32 | offset .gx string
012 | u32 | offset visibiilty


016 |Float| related to visibility 
020 |Float| related to visibility
024 |Float| related to visibility
028 |Float| related to visibility
032 |Float| related to visibility
036 |Float| related to visibility
040 |Float| related to visibility
044 |Float| related to visibility
048 |Float| related to visibility
052 |Float| related to visibility
056 |Float| related to visibility
064 |Float| related to visibility

sections offset:

0 | u32 | amount, 1 based index
4 | u32 | offset

repeat until amount =0,
divisible by 16

000 |Float| render distance
divisible by 16

model mesh header
000 | u32 | 0
004 | u32 | 0
008 | b | ?
009 | b | ?
010 | b | ?
011 | b | ?
012 | u32 | 
016 | u32 | 
020 | u32 | 
024 | u32 | 
028 | u32 | 
032 | u32 |
036 | u32 | 
040 | u32 | 
044 | u32 | 
048 | u32 | 
052 | u32 | 
056 | u32 | 
060 | u32 | 
064 | u32 | 
068 | u32 | 
072 | u32 | 
076 | u32 | 
080 | b8   | 
088 | u32 | 
092 | u32 | 

vertex float array
3 floats per vertex

color array
4 bytes rgba

uv array
2 bytes x
2 bytes y
half floats? not sure







---------------------------
||||   animations  ||||
---------------------------

000 | u32 | offset to ?
004 | u32 | ?0
008 | u32 | ?0

repeat small number of times

3053344
2175072





---------------------------
||||   btf image data  ||||
---------------------------

dxt1 compression format

---------------------------
||||   after image data  ||||
---------------------------

000 | u32 | 4
004 | u32 | offset
008 | float| float
012 | u32 | offset
016 | u32 | 0
020 | u32 | 00 01 00 00
024 | u32 | 0
028 | float| large number
032 | float| large number
036 | u32 | offset
040 | float| float
044 | float| float
048 | u32 | offset
048 | u32 | offset
048 | u32 | offset
048 | u32 | offset
048 | u32 | offset
048 | u32 | offset
048 | u32 | offset
048 | u32 | offset


        <p>ko!</p>
    </section>
</main>`

        return
    }
}

document.getElementById("main_button").addEventListener("click", load_main_page);
document.getElementById("x_button_documentation").addEventListener("click", load_x_documentation);

load_main_page()

function atach_file_to_file_viewer(region, type, index, unknown, amount_bytes, file_offset, id) {

    let file_type_name = ['car', 'interface', 'item', '???', 'world', 'colliders', 'world texture', 'geometry', 'share', 'unknown/not seen', 'music']

    type = file_type_name[type]

    let div = document.createElement("div")

    div.className = 'file noselect'
    div.dataset.region = region
    div.dataset.index = index
    div.dataset.unknown = unknown
    div.dataset.file_bytes = amount_bytes
    div.dataset.file_offset = file_offset
    div.dataset.file = (1 + id)
    div.dataset.type = type
    div.dataset.file_select = 'false'
    div.addEventListener("click", load_file__, false);
    div.append('🗎 ' + (1 + id) + " " + type)

    document.getElementById("file_view").append(div)
}

function atach_folder_to_file_viewer(file_name, extension, region, files) {

    let div = document.createElement("div")

    div.className = 'folder noselect'
    div.dataset.file = file_name
    div.dataset.type = extension
    div.dataset.region_number = region
    div.dataset.number_files = files
    div.append('🗀 ' + file_name)

    document.getElementById("file_view").append(div)
}

function input_file(event) {

    // get file name/extension

    var filename = document.getElementsByTagName("input")[0].files[0].name
    var fileextension = filename.slice((filename.lastIndexOf(".") - 1 >>> 0) + 2);
    fileextension = fileextension.toLowerCase()

    var file = event.target.files[0];
    var reader = new FileReader();

    buffer = reader.readAsArrayBuffer(file);

    document.getElementById("file_input").value = ''

    reader.onload = function(e) {

        buffer = e.target.result
        u8 = new DataView(buffer).getUint8.bind(new DataView(buffer))
        u16 = new DataView(buffer).getUint16.bind(new DataView(buffer))
        u32 = new DataView(buffer).getUint32.bind(new DataView(buffer))
        f32 = new DataView(buffer).getFloat32.bind(new DataView(buffer))

        document.getElementById("file_view").textContent = ''
        document.getElementById("main_program").textContent = ''

        // check magic
        if (u32(0, true) == 33620128) {
            is_little_endian = true
        } else if (u32(0, true) == 2684354818) {
            is_little_endian = false
        } else {
            wrong_file_type()
            return
        }

        document.getElementById("save_button").addEventListener("click", save_buffer);

        //any file past here is a .x* file

        var region_numer = u32(8, is_little_endian)
        var number_files = u32(12, is_little_endian)

        atach_folder_to_file_viewer(filename, fileextension, region_numer, number_files)

        for (files_i = 0; files_i < number_files; files_i++) {
            var offset = (files_i * 24) + 16

            var region = u32(offset + 0, is_little_endian)
            var type = u32(offset + 4, is_little_endian)
            var index = u32(offset + 8, is_little_endian)
            var unknown = u32(offset + 12, is_little_endian)
            var amount_bytes = u32(offset + 16, is_little_endian)
            var file_offset = u32(offset + 20, is_little_endian)

            atach_file_to_file_viewer(region, type, index, unknown, amount_bytes, file_offset, files_i)
        }

    }

}

function wrong_file_type() {
    alert('wrong file type')
    buffer = null
    u8 = null
    u16 = null
    u32 = null
    f32 = null
}

function load_file__() {

    region = this.dataset.region
    file_type = this.dataset.type
    file_index = this.dataset.index
    _0usually = this.dataset.unknown
    number_of_bytes = this.dataset.file_bytes
    offset = this.dataset.file_offset

    index = this.dataset.file - 1
    file = document.body.getElementsByClassName("folder")[0].dataset.type
    number_files = document.body.getElementsByClassName("folder")[0].dataset.number_files
    game = document.querySelector('input[name="a"]:checked').id

    get_offset()

    console.log(`
                 region ${region} 
                 file type: ${file_type}
                 file index: ${file_index}
                 0 usually: ${_0usually}
                 number of bytes: ${number_of_bytes}
                 offset: ${offset}
                 
                 file: ${file}
                 game: ${game}
                 number files ${number_files}
               `)

    for (files_i = 0; files_i < number_files; files_i++) {
        document.getElementsByClassName("file")[files_i].dataset.file_select = 'false'
    }
    document.getElementsByClassName("file")[index].dataset.file_select = 'true'

    _3_00__offset__end_file_offset_list = u32(offset + 00, is_little_endian)
    _3_04__offset__end_sound_offset_list = u32(offset + 04, is_little_endian)
    number_sounds = u32(offset + 08, is_little_endian)
    _3_12__unknown = u32(offset + 12, is_little_endian)
    _3_16__amount__end_sound_list = u32(offset + 16, is_little_endian)
    _3_20__amount__btf_textures = u32(offset + 20, is_little_endian)
    _3_24__offset__btf_textures = u32(offset + 24, is_little_endian)
    _3_28__unknown = u32(offset + 28, is_little_endian)
    _3_32__amount__sound_offset = u32(offset + 32, is_little_endian)
    _3_36__always__0 = u32(offset + 36, is_little_endian)
    _3_40__always__0 = u32(offset + 40, is_little_endian)
    _3_44__always__0 = u32(offset + 44, is_little_endian)
    _3_48__unknown = u32(offset + 48, is_little_endian)
    _3_52__unknown = u32(offset + 52, is_little_endian)
    _3_56__amount__animation_unknown = u32(offset + 56, is_little_endian)
    _3_60__offset__start_animation = u32(offset + 60, is_little_endian)

    get_offset_to_sounds()

    sound_offset_array = []
    for (number_sounds_i = 0; number_sounds_i < number_sounds; number_sounds_i++) {
        sound_offset_array.push(u32(offset + (number_sounds_i * 4), is_little_endian))
    }

    while ((number_sounds_i * 4) % 32 !== 0) {
        number_sounds_i++
    }

    offset_audio = (number_sounds_i * 4) + offset

    _3_04__offset__end_sound_offset_list + offset_audio

    console.log(_3_04__offset__end_sound_offset_list + offset_audio)
    //get to main offset
    offset_mid = (_3_28__unknown + _3_16__amount__end_sound_list + _3_52__unknown) * 8
    while (offset_mid % 32 !== 0) {
        offset_mid++
    }
    offset_mid = offset_mid + _3_04__offset__end_sound_offset_list + offset_audio
    console.log(offset_mid, "mid")

    append_buttons_to_main_program()

}

function get_offset() {

    let header_offset = (u32(12, is_little_endian) * 24) + 16

    offset = header_offset + Number(offset)

}

function get_offset_to_sounds() {
    if (file == "xps") {
        offset += 2048
    } else if (file == "xpp") {
        offset += 128
    } else if (game == "baron") {
        offset += 128
    } else {
        offset += 120
    }

}

function append_buttons_to_main_program() {
    document.getElementById("main_program").innerHTML = `
        <div class='data_types_bar noselect' id='data_types_bar'></div>
        <div style='display:flex;' id='outer_program'>
        </div>
        `

    document.getElementById("data_types_bar").innerHTML = `
    <a data-is_active='false' class='data_bar_options' id='main_program__audio_button'>${number_sounds} sounds </a>
    <a data-is_active='false' class='data_bar_options' id='main_program__texture_button'>${_3_20__amount__btf_textures} textures </a>
    <a data-is_active='false' class='data_bar_options' id='main_program__logic_button'> logic </a>
    `
    document.getElementById("main_program__audio_button").addEventListener("click", load_audio);
    document.getElementById("main_program__texture_button").addEventListener("click", load_textures);
    document.getElementById("main_program__logic_button").addEventListener("click", load_logic);

}

function load_audio() {

    //div.dataset.region
    check_if_other_element_loaded(this)
    if (temp_flag == "false") {
        return
    }

    document.getElementById("outer_program").innerHTML = `
                    <div style='padding-left:25px;padding-bottom:5px;padding-top:5px;width:50%;height:705px;overflow-y: auto;' id='inner_program'></div>
                    <div style='padding-left:25px;padding-bottom:5px;padding-top:5px;width:50%;height:705px;overflow-y: auto;' id='edit_program'><p style='margin:auto;'> choose a sound to display edit options here </p></div>
`

    if (file == "xpp" || file == "xps") {
        document.getElementById("inner_program").innerHTML = "<p> warning psp / ps2 audio formats are unknown </p><br>"
    }

    load_inner_program_table()

    load_wav()
}

function load_wav() {
    endian = is_little_endian
    i_offset = offset_audio
    sound_main_list = offset_audio

    for (i = 0; i < number_sounds; i++,
    i_offset += 32) {
        sound_offset = u32(i_offset, endian)
        sound_length = u32(i_offset + 4, endian)
        sound_ff_ff_ff_ff = u32(i_offset + 8, endian)
        sound_sample_rate = u32(i_offset + 12, endian)
        sound_16 = u32(i_offset + 16, endian)
        sound_20 = u16(i_offset + 20, endian)
        sound_22 = u16(i_offset + 22, endian)

        //create wav file
        wav_ = new ArrayBuffer(sound_length + 44)

        //wav header
        new DataView(wav_).setUint8(0, 82)
        new DataView(wav_).setUint8(1, 73)
        new DataView(wav_).setUint8(2, 70)
        new DataView(wav_).setUint8(3, 70)
        // RIFF

        new DataView(wav_).setUint32(4, wav_.byteLength - 8, true)
        //file size - 8(riff header)

        new DataView(wav_).setUint8(8, 87)
        new DataView(wav_).setUint8(9, 65)
        new DataView(wav_).setUint8(10, 86)
        new DataView(wav_).setUint8(11, 69)
        // WAVE

        new DataView(wav_).setUint8(12, 102)
        new DataView(wav_).setUint8(13, 109)
        new DataView(wav_).setUint8(14, 116)
        new DataView(wav_).setUint8(15, 32)
        // fmt.

        new DataView(wav_).setUint32(16, 16, true)
        //always 16

        new DataView(wav_).setUint16(20, 1, true)
        //1 = pcm format

        new DataView(wav_).setUint16(22, 1, true)
        //channels

        new DataView(wav_).setUint32(24, sound_sample_rate, true)
        //sample rate

        new DataView(wav_).setUint32(28, sound_sample_rate * 16 * 2 / 8, true)

        new DataView(wav_).setUint16(32, 4, true)

        new DataView(wav_).setUint16(34, 16, true)
        //bit per sample

        new DataView(wav_).setUint8(36, 100)
        new DataView(wav_).setUint8(37, 97)
        new DataView(wav_).setUint8(38, 116)
        new DataView(wav_).setUint8(39, 97)
        // data

        new DataView(wav_).setUint32(40, sound_length, true)
        //sound length

        for (ii_length = 0,
        ii = sound_offset + sound_main_list; ii_length < sound_length; ii += 2,
        ii_length += 2) {
            temp = u16(sound_main_list + sound_offset + ii_length, endian)
            new DataView(wav_).setUint16(44 + ii_length, temp, true)
        }

        var objectURL = URL.createObjectURL(new Blob([wav_]))

        document.getElementById("sound_row_select_" + i).addEventListener("click", load_edit_sound);

        var link = document.createElement("audio");
        link.src = objectURL
        link.controls = true
        document.getElementById("sound_table_" + i).appendChild(link)

        var download_sound = document.createElement("a")
        download_sound.href = objectURL
        download_sound.download = objectURL + ".wav"
        download_sound.innerText = "download as .wav"
        document.getElementById("sound_table_" + i + "_download").appendChild(download_sound)

    }
}

function load_textures() {

    check_if_other_element_loaded(this)
    if (temp_flag == "false") {
        return
    }

    load_dtx1()
}

function load_dtx1() {

    let temp_canvas = document.createElement("canvas")
    temp_canvas.id = 'canvas'
    temp_canvas.style = 'width: 0px;'
    document.getElementById("outer_program").appendChild(temp_canvas)

    canvas = document.getElementById('canvas');
    ctx = canvas.getContext('2d');

    _8__offset = offset_mid
    canvas_html = ""

    btf_start = _3_24__offset__btf_textures + _8__offset
    entries = _3_20__amount__btf_textures
    each_entry_bytes = 64
    for (btf_ii = 0,
    btf_i = 0; btf_ii < entries; btf_i += 64,
    btf_ii++) {

        texture_type_value = u8(btf_start + btf_i)
        alpha_loop = 0
        while (alpha_loop < 2) {

            if (texture_type_value == 193 && alpha_loop == 0) {
                btf_offset = u32(btf_start + btf_i + 4, is_little_endian)
                alpha_loop++
                divide_2 = false
            } else if (texture_type_value == 194 && alpha_loop == 0) {
                btf_offset = u32(btf_start + btf_i + 4, is_little_endian)
                alpha_loop++
                divide_2 = true
            } else {
                btf_offset = u32(btf_start + btf_i + 8, is_little_endian)
                alpha_loop += 2
                divide_2 = false
            }

            btf_x = u8(btf_start + btf_i + 2)
            btf_y = u8(btf_start + btf_i + 3)

            btf_x = Math.pow(2, btf_x)
            btf_y = Math.pow(2, btf_y)

            if (divide_2 == true) {
                btf_y = btf_y / 2
                btf_x = btf_x / 2
            }
            canvas.width = btf_x
            canvas.height = btf_y

            // 65 = no alpha
            //193 = with alpha
            for (string_i = 12,
            btf_string = ""; string_i < 64; string_i++) {
                btf_string += String.fromCharCode(u8(btf_start + btf_i + string_i))
            }
            image_offset = btf_offset + _8__offset

            for (outer_2_y = 0; outer_2_y < btf_y; outer_2_y += 8) {
                for (outer_2_x = 0; outer_2_x < btf_x; outer_2_x += 8) {
                    for (outer_y = 0; outer_y < 8; outer_y += 4) {
                        for (outer_x = 0; outer_x < 8; outer_x += 4) {

                            get_color()
                            get_pixel_data()

                            image_offset += 8

                            for (i = 0,
                            y = 0; y < 4; y++) {
                                for (x = 0; x < 4; x++,
                                i++) {

                                    if (temp_pixel_array[i] == "00") {
                                        ctx.fillStyle = "#" + color_1
                                        ctx.fillRect(x + outer_x + outer_2_x, y + outer_y + outer_2_y, 1, 1)
                                    } else if (temp_pixel_array[i] == "01") {
                                        ctx.fillStyle = "#" + color_2
                                        ctx.fillRect(x + outer_x + outer_2_x, y + outer_y + outer_2_y, 1, 1)
                                    } else if (temp_pixel_array[i] == "10") {
                                        ctx.fillStyle = "#" + color_3
                                        ctx.fillRect(x + outer_x + outer_2_x, y + outer_y + outer_2_y, 1, 1)
                                    } else if (temp_pixel_array[i] == "11") {
                                        ctx.fillStyle = "#" + color_4
                                        ctx.fillRect(x + outer_x + outer_2_x, y + outer_y + outer_2_y, 1, 1)
                                    }
                                }

                            }
                        }
                    }
                }
            }
            data_ = canvas.toDataURL()
            raw_bytes = buffer.slice((btf_offset + _8__offset), image_offset)
            raw_bytes = URL.createObjectURL(new Blob([raw_bytes]))

            if (texture_type_value == 193) {
                texture_type = "1 Alpha texture, 1 solid color texture"
            } else if (texture_type_value == 194) {
                texture_type = "1 half sized Alpha texture, 1 solid color texture"
            } else if (texture_type_value == 65) {
                texture_type = "1 solid color texture"
            } else {
                texture_type = "???"
            }
            canvas_html += "<img width='256' height='256' src='" + data_ + "'></img>" + `<br>
            <table class='binary_table'>
                <tbody>
                    <tr>
                        <td>texture name:</td>
                        <td> ` + btf_string + `</td>
                    </tr>
                    <tr>
                        <td>texture type:</td>
                        <td> ` + texture_type + `</td>
                    </tr>
                    <tr>
                        <td>dimensions:</td>
                        <td> ` + btf_x + `x` + btf_y + `</td>
                    </tr>
                    </tr>
                </tbody>
           </table>

` + /*            <table class='binary_table'>
                <thead>
                    <tr>
                        <th>start</th>
                        <th>end</th>
                        <th>total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>` + (btf_offset + _8__offset) +  `</td>
                        <td>` + image_offset + `</td>
                        <td> ` + (image_offset - (btf_offset + _8__offset)) + `</td>
                    </tr>    
                </tbody>
           </table>
*/
            `
           <a href='` + raw_bytes + `' download=' ` + raw_bytes + `.raw'>download raw bytes</a><br>
           <a href='` + data_ + `' download=' ` + data_ + `.png'>download as png</a><br><br>

`
        }
    }
    document.getElementById("outer_program").innerHTML = canvas_html
}

function get_pixel_data() {
    var i = 0
    var temp_1 = 0
    var iii = 0
    for (temp_pixel_array = []; iii < 16; iii += 4,
    i++) {
        var pixel_row = u8(image_offset + i + 4)
        for (ii = 7; ii > 0; ii -= 2,
        temp_1++) {
            let pixel_1 = (pixel_row >> ii) & 0x1;
            let pixel_2 = (pixel_row >> ii - 1) & 0x1;

            temp_pixel_array[temp_1] = pixel_1 + "" + pixel_2
        }
    }
}

function get_color() {
    var i = 0
    var ii = 0
    for (; ii < 2; ii++,
    i += 2) {
        var color_byte1 = u8(image_offset + i)
        var color_byte2 = u8(image_offset + 1 + i)

        let red_bit_1 = (color_byte1 >> 7) & 0x1;
        let red_bit_2 = (color_byte1 >> 6) & 0x1;
        let red_bit_3 = (color_byte1 >> 5) & 0x1;
        let red_bit_4 = (color_byte1 >> 4) & 0x1;
        let red_bit_5 = (color_byte1 >> 3) & 0x1;

        red_bit_1 = red_bit_1 * 16
        red_bit_2 = red_bit_2 * 8
        red_bit_3 = red_bit_3 * 4
        red_bit_4 = red_bit_4 * 2
        red_bit_5 = red_bit_5 * 1

        var red_color = red_bit_1 + red_bit_2 + red_bit_3 + red_bit_4 + red_bit_5

        red_color = Math.round(red_color * 8.2257)

        let green_bit_1 = (color_byte1 >> 2) & 0x1;
        let green_bit_2 = (color_byte1 >> 1) & 0x1;
        let green_bit_3 = (color_byte1 >> 0) & 0x1;
        let green_bit_4 = (color_byte2 >> 7) & 0x1;
        let green_bit_5 = (color_byte2 >> 6) & 0x1;
        let green_bit_6 = (color_byte2 >> 5) & 0x1;

        green_bit_1 = green_bit_1 * 32
        green_bit_2 = green_bit_2 * 16
        green_bit_3 = green_bit_3 * 8
        green_bit_4 = green_bit_4 * 4
        green_bit_5 = green_bit_5 * 2
        green_bit_6 = green_bit_6 * 1

        var green_color = green_bit_1 + green_bit_2 + green_bit_3 + green_bit_4 + green_bit_5 + green_bit_6

        green_color = Math.round(green_color * 4.048)

        let blue_bit_1 = (color_byte2 >> 4) & 0x1;
        let blue_bit_2 = (color_byte2 >> 3) & 0x1;
        let blue_bit_3 = (color_byte2 >> 2) & 0x1;
        let blue_bit_4 = (color_byte2 >> 1) & 0x1;
        let blue_bit_5 = (color_byte2 >> 0) & 0x1;

        blue_bit_1 = blue_bit_1 * 16
        blue_bit_2 = blue_bit_2 * 8
        blue_bit_3 = blue_bit_3 * 4
        blue_bit_4 = blue_bit_4 * 2
        blue_bit_5 = blue_bit_5 * 1

        var blue_color = blue_bit_1 + blue_bit_2 + blue_bit_3 + blue_bit_4 + blue_bit_5

        blue_color = Math.round(blue_color * 8.2257)

        red_color = red_color.toString(16);
        green_color = green_color.toString(16);
        blue_color = blue_color.toString(16);

        if (red_color.length == 1) {
            red_color = '0' + red_color
        }
        if (green_color.length == 1) {
            green_color = '0' + green_color
        }
        if (blue_color.length == 1) {
            blue_color = '0' + blue_color
        }

        if (ii == 0) {
            color_1 = red_color + green_color + blue_color
            red_color_1 = red_color
            green_color_1 = green_color
            blue_color_1 = blue_color
        } else {
            color_2 = red_color + green_color + blue_color

            red_color_1 = parseInt(red_color_1, 16)
            green_color_1 = parseInt(green_color_1, 16)
            blue_color_1 = parseInt(blue_color_1, 16)

            red_color = parseInt(red_color, 16)
            green_color = parseInt(green_color, 16)
            blue_color = parseInt(blue_color, 16)

            if (color_1 > color_2) {

                red_color_3 = (2 * red_color_1 + red_color) / 3
                green_color_3 = (2 * green_color_1 + green_color) / 3
                blue_color_3 = (2 * blue_color_1 + blue_color) / 3

                red_color_4 = (red_color_1 + 2 * red_color) / 3
                green_color_4 = (green_color_1 + 2 * green_color) / 3
                blue_color_4 = (blue_color_1 + 2 * blue_color) / 3

            } else {

                red_color_3 = (red_color_1 + red_color) / 2
                green_color_3 = (green_color_1 + green_color) / 2
                blue_color_3 = (blue_color_1 + blue_color) / 2

                red_color_4 = 0
                green_color_4 = 0
                blue_color_4 = 0

            }

            red_color_3 = Math.round(red_color_3)
            green_color_3 = Math.round(green_color_3)
            blue_color_3 = Math.round(blue_color_3)

            red_color_4 = Math.round(red_color_4)
            green_color_4 = Math.round(green_color_4)
            blue_color_4 = Math.round(blue_color_4)

            red_color_3 = red_color_3.toString(16);
            green_color_3 = green_color_3.toString(16);
            blue_color_3 = blue_color_3.toString(16);

            red_color_4 = red_color_4.toString(16);
            green_color_4 = green_color_4.toString(16);
            blue_color_4 = blue_color_4.toString(16);

            if (red_color_3.length == 1) {
                red_color_3 = '0' + red_color_3
            }
            if (green_color_3.length == 1) {
                green_color_3 = '0' + green_color_3
            }
            if (blue_color_3.length == 1) {
                blue_color_3 = '0' + blue_color_3
            }

            if (parseInt(red_color_3, 16) > 255) {
                red_color_3 = "FF"
            }
            if (parseInt(green_color_3, 16) > 255) {
                green_color_3 = "FF"
            }
            if (parseInt(blue_color_3, 16) > 255) {
                blue_color_3 = "FF"
            }
            //
            //
            if (red_color_4.length == 1) {
                red_color_4 = '0' + red_color_4
            }
            if (green_color_4.length == 1) {
                green_color_4 = '0' + green_color_4
            }
            if (blue_color_4.length == 1) {
                blue_color_4 = '0' + blue_color_4
            }

            color_3 = red_color_3 + green_color_3 + blue_color_3

            color_4 = red_color_4 + green_color_4 + blue_color_4

        }
    }

}

function check_if_other_element_loaded(tag) {
    if (tag.dataset.is_active == 'true') {
        return temp_flag = "false"
    }

    for (var i = 0; i < document.getElementsByClassName("data_bar_options").length; i++) {
        document.getElementsByClassName("data_bar_options")[i].dataset.is_active = 'false'
    }

    tag.dataset.is_active = 'true'
    temp_flag = "true"
}

function load_logic() {
    check_if_other_element_loaded(this)
    if (temp_flag == "false") {
        return
    }

    document.getElementById("outer_program").innerHTML = "no idea how to parse this"

}

function load_inner_program_table() {
    var table = document.createElement('table');
    table.className = 'binary_table noselect'
    table.style.textAlign = 'center'
    table.innerHTML = `
                      <thead>
                          <tr>
                              <th>index</th>
                              <th>sound</th>
                              <th> download </th>
                          </tr>
                      </thead>
    `
    table.createTBody()

    for (let temp_i = 0; temp_i < number_sounds; temp_i++) {

        table.getElementsByTagName("tbody")[0].innerHTML += `<tr data-sound_row_select='false' class='sound_row_select' id='sound_row_select_${temp_i}'>
        <td> ${temp_i + 1} </td>
        <td id='sound_table_${temp_i}'></td>
        <td id='sound_table_${temp_i}_download'></td>
    </tr>`
    }

    table.innerHTML += `</tbody>`

    document.getElementById("inner_program").appendChild(table);

}
function load_edit_sound() {

    for (var i = 0; i < document.getElementsByClassName("binary_table")[0].children[1].children.length; i++) {
        document.getElementsByClassName("binary_table")[0].children[1].children[i].dataset.sound_row_select = 'false'
    }
    let select_row_index = this.getElementsByTagName('td')[0].innerText - 1
    document.getElementsByClassName("binary_table")[0].children[1].children[select_row_index].dataset.sound_row_select = 'true'

    i_offset = offset_audio + (32 * select_row_index)

    sound_offset = u32(i_offset, endian)
    sound_length = u32(i_offset + 4, endian)
    sound_ff_ff_ff_ff = u32(i_offset + 8, endian)
    sound_sample_rate = u32(i_offset + 12, endian)
    sound_16 = u32(i_offset + 16, endian)
    sound_20 = u16(i_offset + 20, endian)
    sound_22 = u16(i_offset + 22, endian)
    sound_24 = u32(i_offset + 24, endian)
    sound_28 = u32(i_offset + 28, endian)

    // get values from sound
    document.getElementById("edit_program").innerHTML = `
    <label for='sound_box_offset'> offset </label>
    <input id='sound_box_offset' type='text'></input><br>

    <label for='sound_box_length'> length</label>
    <input id='sound_box_length' type='text'></input><br>

    <label for='sound_box_ff'> unknown boolean like </label>
    <input id='sound_box_ff' type='text'></input><br>

    <label for='sound_box_sample_rate'> sound sample rate </label>
    <input id='sound_box_sample_rate' type='text'></input><br>

    <label for='sound_box_16'> unknown ? </label>
    <input id='sound_box_16' type='text'></input><br>

    <label for='sound_box_20'> unknown ? </label>
    <input id='sound_box_20' type='text'></input><br>

    <label for='sound_box_22'> unknown ? </label>    
    <input id='sound_box_22' type='text'></input><br>

    <label for='sound_box_24'> padding ? always 0 </label>    
    <input id='sound_box_24' type='text'></input><br>
    
    <label for='sound_box_28'> padding ? always 0</label>
    <input id='sound_box_28' type='text'></input><br>
    <hr>
    <input type='file' id='replace_sound_file'> replace wav file
    <a id='save_sound_file'> save new value </a>
    `

    document.getElementById("sound_box_offset").value = sound_offset;
    document.getElementById("sound_box_length").value = sound_length;
    document.getElementById("sound_box_ff").value = sound_ff_ff_ff_ff;
    document.getElementById("sound_box_sample_rate").value = sound_sample_rate;
    document.getElementById("sound_box_16").value = sound_16;
    document.getElementById("sound_box_20").value = sound_20;
    document.getElementById("sound_box_22").value = sound_22;
    document.getElementById("sound_box_24").value = sound_24;
    document.getElementById("sound_box_28").value = sound_28;

    document.getElementById("replace_sound_file").addEventListener("change", load_replace_sound_file);
    document.getElementById("save_sound_file").addEventListener("click", load_save_sound_file);

}

function load_replace_sound_file(event) {
    document.getElementById("replace_sound_file")

    var filename = document.getElementById("replace_sound_file").files[0].name
    var fileextension = filename.slice((filename.lastIndexOf(".") - 1 >>> 0) + 2);
    fileextension = fileextension.toLowerCase()

    var file = event.target.files[0];
    var reader = new FileReader();

    replace_sound_buffer = reader.readAsArrayBuffer(file);

    document.getElementById("replace_sound_file").value = ''

    console.log(fileextension)

    reader.onload = function(e) {
        replace_sound_buffer = e.target.result

        if (new DataView(replace_sound_buffer).getUint32(0, true) != 1179011410) {
            console.log('not wav')
            return
        }
        let audio_replace_sample_rate = new DataView(replace_sound_buffer).getUint32(24, true)
        // samplerate

        //get index
        let node = document.querySelector(`tr[data-sound_row_select="true"]`)
        let temp_index = Array.prototype.indexOf.call(node.parentNode.childNodes, node);

        offset_audio_replace = offset_audio + (32 * temp_index)

        new DataView(buffer).setUint32(offset_audio_replace + 12, audio_replace_sample_rate, is_little_endian)

        //get offset /lengtyh box
        old_sound_offset = document.getElementById("sound_box_offset").value
        old_sound_length = document.getElementById("sound_box_length").value

        old_sound_offset = Number(old_sound_offset) + offset_audio

        //get new dataview?

        replace_sound_buffer = replace_sound_buffer.slice(44)

        temp_sound_buffer = new ArrayBuffer(old_sound_length)
        temp_sound_buffer = replace_sound_buffer

        //replace buffer with new wav

        if (replace_sound_buffer.byteLength >= old_sound_length) {

            for (ii_length = 0; ii_length < old_sound_length; ii_length += 2) {
                let temp = new DataView(temp_sound_buffer).getUint16(ii_length, true)
                new DataView(buffer).setUint16(old_sound_offset + ii_length, temp, is_little_endian)
            }

        } else {
            for (ii_length = 0; ii_length < replace_sound_buffer.byteLength; ii_length += 2) {
                let temp = new DataView(temp_sound_buffer).getUint16(ii_length, true)
                new DataView(buffer).setUint16(old_sound_offset + ii_length, temp, is_little_endian)
            }

            for (ii_length = replace_sound_buffer.byteLength; ii_length < old_sound_length; ii_length += 2) {
                new DataView(buffer).setUint16(old_sound_offset + ii_length, 0, is_little_endian)
            }

        }

    }

}
function load_save_sound_file() {}

function generate_wav_header(sound_length, sound_sample_rate) {
    //create wav file
    wav_ = new ArrayBuffer(sound_length + 44)

    //wav header
    new DataView(wav_).setUint8(0, 82)
    new DataView(wav_).setUint8(1, 73)
    new DataView(wav_).setUint8(2, 70)
    new DataView(wav_).setUint8(3, 70)
    // RIFF

    new DataView(wav_).setUint32(4, wav_.byteLength - 8, true)
    //file size - 8(riff header)

    new DataView(wav_).setUint8(8, 87)
    new DataView(wav_).setUint8(9, 65)
    new DataView(wav_).setUint8(10, 86)
    new DataView(wav_).setUint8(11, 69)
    // WAVE

    new DataView(wav_).setUint8(12, 102)
    new DataView(wav_).setUint8(13, 109)
    new DataView(wav_).setUint8(14, 116)
    new DataView(wav_).setUint8(15, 32)
    // fmt.

    new DataView(wav_).setUint32(16, 16, true)
    //always 16

    new DataView(wav_).setUint16(20, 1, true)
    //1 = pcm format

    new DataView(wav_).setUint16(22, 1, true)
    //channels

    new DataView(wav_).setUint32(24, sound_sample_rate, true)
    //sample rate

    new DataView(wav_).setUint32(28, sound_sample_rate * 16 * 2 / 8, true)

    new DataView(wav_).setUint16(32, 4, true)

    new DataView(wav_).setUint16(34, 16, true)
    //bit per sample

    new DataView(wav_).setUint8(36, 100)
    new DataView(wav_).setUint8(37, 97)
    new DataView(wav_).setUint8(38, 116)
    new DataView(wav_).setUint8(39, 97)
    // data

    new DataView(wav_).setUint32(40, sound_length, true)
    //sound length

}

function save_buffer() {

    if (buffer == null) {} else {

        var objectURL = URL.createObjectURL(new Blob([buffer]))

        let download_file = document.createElement("a")
        download_file.id = 'temp_download_file'
        download_file.href = objectURL
        download_file.download = document.body.getElementsByClassName("folder")[0].dataset.file
        document.getElementById("save_button").appendChild(download_file)

        document.getElementById("temp_download_file").click()

        document.getElementById("temp_download_file").remove()
    }

}

        </script>
    </body>
</html>
